# Claude with MCP - MCPサーバー設定付きClaude起動スクリプト

## 概要
このスクリプトは、Claude Codeを起動する前にMCPサーバーの設定を対話的に行うシェルスクリプトです。既に設定されているMCPサーバーは自動的にスキップされ、重複した設定を防ぎます。現在はSerena MCPに対応しており、簡単に他のMCPサーバーを追加できる拡張可能な設計になっています。

## 使い方

### 基本的な使用方法
```bash
./claude-with-mcp.sh
```

スクリプトを実行すると、以下のような対話的なプロンプトが表示されます：
```
Serena MCPを使用しますか？[y/n]: 
```

- `y` を入力: Serena MCPを設定してからClaude Codeを起動
- `n` を入力: MCPの設定をスキップしてClaude Codeを起動

**注意**: 既に設定済みのMCPサーバーがある場合は、「既に設定されています。スキップします。」というメッセージが表示され、自動的にスキップされます。

## 機能

### 主な機能
- **重複チェック機能**: `claude mcp list`を使用して既存のMCPサーバーを検出し、重複した設定を防ぎます
- **対話的な設定**: 各MCPサーバーを使用するかどうかをユーザーが選択できます
- **エラーハンドリング**: 設定中にエラーが発生した場合は適切に処理します
- **NVMサポート**: Node Version Manager (NVM) が利用可能な場合は自動的に初期化します

### 現在対応しているMCPサーバー
- **Serena MCP**: IDEアシスタントコンテキストでプロジェクトを支援

### 拡張性
新しいMCPサーバーを追加する場合は、`main()`関数内に以下のように追加します：

```bash
setup_mcp_server \
    "表示名" \
    "プロンプトメッセージ" \
    "サーバーID" \
    セットアップコマンド
```

パラメータの説明：
- **表示名**: ユーザーに表示されるMCPサーバーの名前
- **プロンプトメッセージ**: ユーザーに表示される確認メッセージ
- **サーバーID**: `claude mcp list`で識別されるサーバーのID（重複チェックに使用）
- **セットアップコマンド**: MCPサーバーを設定するためのコマンド

例：
```bash
setup_mcp_server \
    "GitHub MCP" \
    "GitHub MCPを使用しますか？" \
    "github" \
    claude mcp add github -- npx @modelcontextprotocol/server-github
```

## 必要な環境

- Bash
- Claude CLI (`claude`コマンド)
- インターネット接続（MCPサーバーのインストール時）
- （オプション）Node Version Manager (NVM)

## インストール

1. スクリプトをダウンロードまたはコピー
2. 実行権限を付与（すでに付与済みの場合はスキップ）：
```bash
chmod +x claude-with-mcp.sh
```

## 技術的な詳細

### 関数の説明

#### `check_mcp_server_exists()`
指定されたMCPサーバーが既に設定されているかを確認します。`claude mcp list`の出力を解析して判定します。

#### `setup_mcp_server()`
MCPサーバーの設定を管理するメイン関数です。以下の処理を行います：
1. 既存のサーバーの存在確認
2. ユーザーへの対話的な確認
3. セットアップコマンドの実行
4. エラーハンドリング

## エラーハンドリング

- MCPサーバーの設定に失敗した場合、エラーメッセージを表示して処理を中止します
- 各MCPサーバーの設定は独立しており、一つが失敗しても他の設定には影響しません
- 大文字小文字を区別しない入力処理（Y/y、N/nどちらも受け付けます）
